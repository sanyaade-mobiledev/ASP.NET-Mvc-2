//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
// WebParts.js
Type.registerNamespace("Sys.Preview.UI.WebParts");var __wpm=null;function Point(a,b){this.x=a;this.y=b}function __getOffset(e,a){if(a.offsetY&&a.offsetY)return {x:a.offsetX,y:a.offsetY};var b=Sys.UI.DomElement.getLocation(e),c=window.pageXOffset+a.clientX-b.x,d=window.pageYOffset+a.clientY-b.y;return {x:c,y:d}}function cancelEvent(a){if(a.preventDefault&&a.stopPropagation){a.preventDefault();a.stopPropagation()}else if(window.event){window.event.returnValue=false;window.event.cancelBubble=true}}function __wpTranslateOffset(b,c,a,e,f){while(typeof a!="undefined"&&a!=null&&a!=e){b+=a.offsetLeft;c+=a.offsetTop;var d=a.tagName;if(d!="TABLE"&&d!="BODY"){if(a.clientLeft)b+=a.clientLeft;if(a.clientTop)c+=a.clientTop}if(f&&d!="BODY"){b-=a.scrollLeft;c-=a.scrollTop}a=a.offsetParent}return new Point(b,c)}function __wpGetPageEventLocation(a,c){if(typeof a=="undefined"||a==null)a=window._event;var b=__getOffset(a.target,a.rawEvent);return __wpTranslateOffset(b.x,b.y,a.target,null,c)}function WebPart(b,a,e,d,c){this.webPartElement=b;this.allowZoneChange=c;this.zone=e;this.zoneIndex=d;this.title=a?a.textContent||a.innerText||"":"";b.__webPart=this;if(typeof a!="undefined"&&a!=null)a.style.cursor="move";this.UpdatePosition=WebPart_UpdatePosition;this.Dispose=WebPart_Dispose}function WebPart_Dispose(){this.webPartElement.__webPart=null}function WebPart_UpdatePosition(){var a=__wpTranslateOffset(0,0,this.webPartElement,null,false);this.middleX=a.x+this.webPartElement.offsetWidth/2;this.middleY=a.y+this.webPartElement.offsetHeight/2}function Zone(c,h,i,d,f,g){var b=null;if(c.rows.length==1)webPartTableContainer=c.rows[0].cells[0];else webPartTableContainer=c.rows[1].cells[0];var a;for(a=0;a<webPartTableContainer.childNodes.length;a++){var e=webPartTableContainer.childNodes[a];if(e.tagName=="TABLE"){b=e;break}}this.zoneElement=c;this.zoneIndex=h;this.webParts=[];this.uniqueID=i;this.isVertical=d;this.allowLayoutChange=f;this.allowDrop=false;this.webPartTable=b;this.highlightColor=g;this.savedBorderColor=b!=null?b.style.borderColor:null;this.dropCueElements=[];if(b!=null)if(d)for(a=0;a<b.rows.length;a+=2)this.dropCueElements[a/2]=b.rows[a].cells[0].childNodes[0];else for(a=0;a<b.rows[0].cells.length;a+=2)this.dropCueElements[a/2]=b.rows[0].cells[a].childNodes[0];this.AddWebPart=Zone_AddWebPart;this.GetWebPartIndex=Zone_GetWebPartIndex;this.ToggleDropCues=Zone_ToggleDropCues;this.UpdatePosition=Zone_UpdatePosition;this.Dispose=Zone_Dispose;b.__zone=this}function Zone_Dispose(){for(var a=0;a<this.webParts.length;a++)this.webParts[a].Dispose();this.webPartTable.__zone=null}function Zone_AddWebPart(d,e,c){var a=null,b=this.webParts.length;if(this.allowLayoutChange&&__wpm.IsDragDropEnabled())a=new WebPart(d,e,this,b,c);else a=new WebPart(d,null,this,b,c);this.webParts[b]=a;return a}function Zone_ToggleDropCues(g,f,h){if(h==false)this.webPartTable.style.borderColor=g?this.highlightColor:this.savedBorderColor;if(f==-1)return;var a=this.dropCueElements[f];if(a&&a.style){if(a.style.height=="100%"&&!a.webPartZoneHorizontalCueResized){var c=a.parentNode.clientHeight,e=c-10;a.style.height=e+"px";var b=a.getElementsByTagName("DIV")[0];if(b&&b.style){b.style.height=a.style.height;var d=a.parentNode.clientHeight-c;if(d){a.style.height=e-d+"px";b.style.height=a.style.height}}a.webPartZoneHorizontalCueResized=true}a.style.visibility=g?"visible":"hidden"}}function Zone_GetWebPartIndex(e){var b=e.x,c=e.y;if(b<this.webPartTableLeft||b>this.webPartTableRight||c<this.webPartTableTop||c>this.webPartTableBottom)return -1;var h=this.isVertical,f=this.webParts,d=f.length;for(var a=0;a<d;a++){var g=f[a];if(h){if(c<g.middleY)return a}else if(b<g.middleX)return a}return d}function Zone_UpdatePosition(){var a=__wpTranslateOffset(0,0,this.webPartTable,null,false);this.webPartTableLeft=a.x;this.webPartTableTop=a.y;this.webPartTableRight=this.webPartTable!=null?a.x+this.webPartTable.offsetWidth:a.x;this.webPartTableBottom=this.webPartTable!=null?a.y+this.webPartTable.offsetHeight:a.y;for(var b=0;b<this.webParts.length;b++)this.webParts[b].UpdatePosition()}function WebPartMenu(b,a,c){this.menuLabelElement=b;this.menuDropDownElement=a;this.menuElement=c;this.menuLabelElement.__menu=this;this.menuLabelElement.attachEvent("onclick",WebPartMenu_OnClick);this.menuLabelElement.attachEvent("onkeypress",WebPartMenu_OnKeyPress);this.menuLabelElement.attachEvent("onmouseenter",WebPartMenu_OnMouseEnter);this.menuLabelElement.attachEvent("onmouseleave",WebPartMenu_OnMouseLeave);if(typeof this.menuDropDownElement!="undefined"&&this.menuDropDownElement!=null)this.menuDropDownElement.__menu=this;this.menuItemStyle="";this.menuItemHoverStyle="";this.popup=null;this.hoverClassName="";this.hoverColor="";this.oldColor=this.menuLabelElement.style.color;this.oldTextDecoration=this.menuLabelElement.style.textDecoration;this.oldClassName=this.menuLabelElement.className;this.Show=WebPartMenu_Show;this.Hide=WebPartMenu_Hide;this.Hover=WebPartMenu_Hover;this.Unhover=WebPartMenu_Unhover;this.Dispose=WebPartMenu_Dispose;var d=this;Sys.Application.add_unload(function(){d.Dispose()})}function WebPartMenu_Dispose(){this.menuLabelElement.__menu=null;this.menuDropDownElement.__menu=null}function WebPartMenu_Show(){if(typeof __wpm.menu!="undefined"&&__wpm.menu!=null)__wpm.menu.Hide();var e="<html><head><style>"+"a.menuItem, a.menuItem:Link { display: block; padding: 1px; text-decoration: none; "+this.itemStyle+" }"+"a.menuItem:Hover { "+this.itemHoverStyle+" }"+'</style><body scroll="no" style="border: none; margin: 0; padding: 0;" ondragstart="window.event.returnValue=false;" onclick="popup.hide()">'+this.menuElement.innerHTML+"<body></html>",b=16,c=16;this.popup=window.createPopup();__wpm.menu=this;var d=this.popup.document;d.write(e);this.popup.show(0,0,b,c);var a=d.body;b=a.scrollWidth;c=a.scrollHeight;if(b<this.menuLabelElement.offsetWidth)b=this.menuLabelElement.offsetWidth+16;if(this.menuElement.innerHTML.indexOf("progid:DXImageTransform.Microsoft.Shadow")!=-1)a.style.paddingRight="4px";a.__wpm=__wpm;a.__wpmDeleteWarning=__wpmDeleteWarning;a.__wpmCloseProviderWarning=__wpmCloseProviderWarning;a.popup=this.popup;this.popup.hide();this.popup.show(0,this.menuLabelElement.offsetHeight,b,c,this.menuLabelElement)}function WebPartMenu_Hide(){if(__wpm.menu==this){__wpm.menu=null;if(typeof this.popup!="undefined"&&this.popup!=null){this.popup.hide();this.popup=null}}}function WebPartMenu_Hover(){if(this.labelHoverClassName!="")this.menuLabelElement.className=this.menuLabelElement.className+" "+this.labelHoverClassName;if(this.labelHoverColor!="")this.menuLabelElement.style.color=this.labelHoverColor}function WebPartMenu_Unhover(){if(this.labelHoverClassName!=""){this.menuLabelElement.style.textDecoration=this.oldTextDecoration;this.menuLabelElement.className=this.oldClassName}if(this.labelHoverColor!="")this.menuLabelElement.style.color=this.oldColor}function WebPartMenu_OnClick(){var a=window.event.srcElement.__menu;if(typeof a!="undefined"&&a!=null){cancelEvent(window.event);a.Show()}}function WebPartMenu_OnKeyPress(){if(window.event.keyCode==13){var a=window.event.srcElement.__menu;if(typeof a!="undefined"&&a!=null){cancelEvent(window.event);a.Show()}}}function WebPartMenu_OnMouseEnter(){var a=window.event.srcElement.__menu;if(typeof a!="undefined"&&a!=null)a.Hover()}function WebPartMenu_OnMouseLeave(){var a=window.event.srcElement.__menu;if(typeof a!="undefined"&&a!=null)a.Unhover()}function WebPartManager(){this.overlayContainerElement=null;this.zones=[];this.menu=null;this.draggedWebPart=null;this.AddZone=WebPartManager_AddZone;this.IsDragDropEnabled=WebPartManager_IsDragDropEnabled;this.ShowHelp=WebPartManager_ShowHelp;this.Execute=WebPartManager_Execute;this.SubmitPage=WebPartManager_SubmitPage;this.UpdatePositions=WebPartManager_UpdatePositions;Sys.Application.add_unload(WebPartManager_Dispose)}function WebPartManager_Dispose(){for(var a=0;a<__wpm.zones.length;a++)__wpm.zones[a].Dispose()}function WebPartManager_AddZone(e,g,f,c,d){var a=this.zones.length,b=new Zone(e,a,g,f,c,d);this.zones[a]=b;return b}function WebPartManager_IsDragDropEnabled(){return typeof this.overlayContainerElement!="undefined"&&this.overlayContainerElement!=null}function WebPartManager_Execute(b){if(this.menu)this.menu.Hide();var a=new Function(b);return a()!=false}function WebPartManager_ShowHelp(b,a){if(typeof this.menu!="undefined"&&this.menu!=null)this.menu.Hide();if(a==0||a==1)if(a==0){var c="edge: Sunken; center: yes; help: no; resizable: yes; status: no";window.showModalDialog(b,null,c)}else window.open(b,null,"scrollbars=yes,resizable=yes,status=no,toolbar=no,menubar=no,location=no");else if(a==2)window.location=b}function WebPartManager_UpdatePositions(){for(var a=0;a<this.zones.length;a++)this.zones[a].UpdatePosition()}function WebPartManager_SubmitPage(b,a){if(typeof this.menu!="undefined"&&this.menu!=null)this.menu.Hide();__doPostBack(b,a)}Sys.Preview.UI.Controls.WebParts.WebPart=function(e){Sys.Preview.UI.Controls.WebParts.WebPart.initializeBase(this,[e]);var a,b,d,c=true;this.get_allowZoneChange=function(){return c};this.set_allowZoneChange=function(a){c=a};this.get_titleElement=function(){return a};this.set_titleElement=function(b){a=b};this.get_zone=function(){return b};this.set_zone=function(a){b=a};this.get_zoneIndex=function(){return d};this.set_zoneIndex=function(a){d=a};this.initialize=function(){Sys.Preview.UI.Controls.WebParts.WebPart.callBaseMethod(this,"initialize");if(a&&b.get_webPartManager().get_allowPageDesign()&&b.get_allowLayoutChange()){var c=this.get_element();Sys.UI.DomEvent.addHandler(a,"mousedown",Function.createDelegate(this,f));a.style.cursor="move"}};function f(a){window._event=a;b.startDragDrop(this);a.preventDefault()}};Sys.Preview.UI.Controls.WebParts.WebPart.registerClass("Sys.Preview.UI.Controls.WebParts.WebPart",Sys.UI.Control);Sys.Preview.UI.Controls.WebParts.WebPart.descriptor={properties:[{name:"titleElement",isDomElement:true},{name:"zone",type:Object},{name:"zoneIndex",type:Number},{name:"allowZoneChange",type:Boolean}]};Sys.Preview.UI.Controls.WebParts.WebPartManager=function(b){Sys.Preview.UI.Controls.WebParts.WebPartManager.initializeBase(this,[b]);var a;this.get_allowPageDesign=function(){return a};this.set_allowPageDesign=function(b){a=b};this.initialize=function(){Sys.Preview.UI.Controls.WebParts.WebPartManager.callBaseMethod(this,"initialize");var a=Function.createDelegate(__wpm,__wpm.ShowHelp);__wpm.ShowHelp=function(d,c){var b;if(c==0&&!window.showModalDialog)b=1;else b=c;a(d,b)}}};Sys.Preview.UI.Controls.WebParts.WebPartManager.registerClass("Sys.Preview.UI.Controls.WebParts.WebPartManager",Sys.UI.Control);Sys.Preview.UI.Controls.WebParts.WebPartManager.descriptor={properties:[{name:"allowPageDesign",type:Boolean}]};Sys.Preview.UI.Controls.WebParts.WebPartZone=function(k){Sys.Preview.UI.Controls.WebParts.WebPartZone.initializeBase(this,[k]);var i="WebPart",d=true,g,e,b=-1,h=false,c,a;this.get_allowLayoutChange=function(){return d};this.set_allowLayoutChange=function(a){d=a};this.get_uniqueId=function(){return g};this.set_uniqueId=function(a){g=a};this.get_webPartManager=function(){return e};this.set_webPartManager=function(a){e=a};function j(d){var a=document.createElement("div");a.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity=0.75);";a.style.opacity="0.75";a.style.position="absolute";a.style.zIndex=32000;var b=d.get_element(),c=Sys.UI.DomElement.getLocation(b);Sys.UI.DomElement.setLocation(a,c.x,c.y);a.style.display="block";a.style.width=b.offsetWidth+"px";a.style.height=b.offsetHeight+"px";a.appendChild(b.cloneNode(true));return a}this.dispose=function(){Sys.Preview.UI.Controls.WebParts.WebPartZone.callBaseMethod(this,"dispose");if(h)Sys.Preview.UI.DragDropManager.unregisterDropTarget(this)};this.initialize=function(){Sys.Preview.UI.Controls.WebParts.WebPartZone.callBaseMethod(this,"initialize");var c=this.get_element();for(var b=0;b<__wpm.zones.length;b++)if(__wpm.zones[b].zoneElement==c){a=__wpm.zones[b];break}if(e.get_allowPageDesign()&&d){Sys.Preview.UI.DragDropManager.registerDropTarget(this);h=true}};this.startDragDrop=function(a){__wpm.UpdatePositions();c=j(a);document.body.appendChild(c);Sys.Preview.UI.DragDropManager.startDragDrop(this,c,a)};this.get_dragDataType=function(){return i};this.getDragData=function(a){return a};this.get_dragMode=function(){return Sys.Preview.UI.DragMode.Copy};this.onDragStart=function(){};this.onDrag=function(){};this.onDragEnd=function(){document.body.removeChild(c)};this.get_dropTargetElement=function(){return a.webPartTable};this.canDrop=function(c,b,d){var a=d;return c==Sys.Preview.UI.DragMode.Copy&&b==i&&Sys.Preview.UI.Controls.WebParts.WebPart.isInstanceOfType(a)&&(a.get_allowZoneChange()||a.get_zone()==this)&&f()!=-1};this.drop=function(i,h,f){a.ToggleDropCues(false,b,false);var c=f;if(l(c,this,b)){var e=g,d="Drag:"+c.get_id()+":"+b;__doPostBack(e,d)}};function l(a,c,b){if(c!=a.get_zone())return true;if(b==a.get_zoneIndex()||b==a.get_zoneIndex()+1)return false;return true}this.onDragEnterTarget=function(){var c=f();a.ToggleDropCues(true,c,false);b=c};this.onDragLeaveTarget=function(){a.ToggleDropCues(false,b,false)};this.onDragInTarget=function(){var c=f();if(c!=b){a.ToggleDropCues(false,b,true);a.ToggleDropCues(true,c,true);b=c}};function f(){var b=__wpGetPageEventLocation(window._event,false);return a.GetWebPartIndex(b)}};Sys.Preview.UI.Controls.WebParts.WebPartZone.registerClass("Sys.Preview.UI.Controls.WebParts.WebPartZone",Sys.UI.Control,Sys.Preview.UI.IDragSource,Sys.Preview.UI.IDropTarget);Sys.Preview.UI.Controls.WebParts.WebPartZone.descriptor={properties:[{name:"uniqueId",type:String},{name:"webPartManager",type:Object},{name:"allowLayoutChange",type:Boolean}]};
if(typeof(Sys)!=='undefined')Sys.Application.notifyScriptLoaded();
