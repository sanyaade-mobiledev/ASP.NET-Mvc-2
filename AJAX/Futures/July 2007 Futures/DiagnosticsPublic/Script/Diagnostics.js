//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
// Diagnostics.js
Type.registerNamespace("Sys.Preview.Diagnostics");Sys.Preview._DiagnosticsService=function(){Sys.Preview._DiagnosticsService.initializeBase(this);this._exceptions=[];this._traces=[];this._timeout=2000;this._timeoutTimerId=-1;this.set_path("DiagnosticsService.asmx");this.start()};Sys.Preview._DiagnosticsService.prototype={get_path:function(){return this._path||""},set_path:function(a){this._path=a},_onError:function(c,d,b){var a={};this._exceptions.push(a);a.Reported=false;a.Filename=d;a.LineNumber=b;a.Message=c;return true},start:function(){window.onerror=Function.createDelegate(this,this._onError);this.startTimer()},dispose:function(){this.stopTimer();this.reportExceptions();window.onerror=null;Sys.Preview._DiagnosticsService.callBaseMethod(this,"dispose")},startTimer:function(){this._timeoutTimerId=window.setTimeout(Function.createDelegate(this,this._onTimer),this._timeout)},stopTimer:function(){window.clearTimeout(this._timeoutTimerId)},_onTimer:function(){this.reportExceptions()},reportExceptions:function(){var f={},g="ReportExceptions",c=[],e=0,b,a;for(var d=0,h=this._exceptions.length;d<h;d++){a=this._exceptions[d];if(!a.Reported){c[e]=b={};b.Filename=a.Filename;b.LineNumber=a.LineNumber;b.Message=a.Message;a.Reported=true;e++}}if(c.length>0){f={exceptionInfos:c};Sys.Net.WebServiceProxy.invoke(this.get_path(),g,false,f,null,Function.createDelegate(this,this._onReportFailed),null)}},display:function(){},_onReportFailed:function(){}};Sys.Preview._DiagnosticsService.registerClass("Sys.Preview._DiagnosticsService",Sys.Component);Sys.Preview.DiagnosticsService=new Sys.Preview._DiagnosticsService;
if(typeof(Sys)!=='undefined')Sys.Application.notifyScriptLoaded();
